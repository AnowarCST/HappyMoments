<!DOCTYPE html>
<html>
    <head>
        <title>Login Page</title>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <script src="js/jquery-1.8.3.min.js"></script>
        <script src="js/jquery.mobile-1.2.0.min.js"></script>
        <link href="css/jquery.mobile.structure-1.2.0.min.css" rel="stylesheet">
        <link href="css/jquery.mobile.theme-1.2.0.min.css" rel="stylesheet">
        <link href="css/jquery.mobile-1.2.0.min.css" rel="stylesheet">
        <link href="css/photoswipe.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <!--                <script src="js/script.js"></script>
                        <script src="js/settings.js"></script>
                        <script src="js/klass.min.js"></script>-->
        <script src="js/code.photoswipe.jquery-3.0.5.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
    </head>

    <body>

        <!-- Login page -->
        <div data-role="page" id="contact" data-title="Contact">
            <div data-role="header">
                <h1>Login</h1>
            </div>
            <div data-role="content">
                <form method="POST" action="#" id="login" novalidate="novalidate">
                    <div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
                        <label for="username" class="ui-input-text">
                            User Name:
                        </label>
                        <input type="text" class="required ui-input-text ui-body-d ui-corner-none ui-shadow-inset"
                               value="" name="username" id="username" data-corners="false">
                    </div>
                    <div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
                        <label for="password" class="ui-input-text">
                            Password:
                        </label>
                        <input type="password" class="required ui-input-text ui-body-d ui-corner-none ui-shadow-inset"
                               value="" name="password" id="password" data-corners="false">
                    </div>
                    <div data-role="fieldcontain" class="ui-field-contain ui-body ui-br" data-corners="false" data-rel="external">
                        <button type="submit" data-theme="d" name="Login" id="login_submit" value="Login" data-rel="external" data-ajax="false" class="ui-btn-hidden ui-body-d ui-corner-none ui-shadow-inset" aria-disabled="false" data-corners="false" style="background: #2373a5">
                            Login
                        </button>
                    </div>
                </form>

            </div>
            <div data-role="footer">
                <h2>Tracking System</h2>
                <p class="copyright">&copy; Copyright 2015 </p>
            </div>
        </div>
        <script>
//            document.addEventListener("deviceready", onDeviceReady, false);
            $(document).ready(function() {
//                if (localStorage.logged == true) {
//                    window.location.replace("home.html");
//                }
//                alert(Date.now());
                $("#login").submit(function() {
                    var username = $('#username').val();
                    var password = $('#password').val();
                    if (username != '' && password != '') {
                        $.ajax({
                            type: 'POST',
                            url: 'http://10.0.2.2/app_service/login.php',
                            crossDomain: true,
                            data: {u_name: username, u_pass: password},
                            dataType: 'json',
                            async: false,
                            success: function(data) {
//                            alert("response");
                                if (data.success) {
//                                alert("you're logged in");
                                    window.localStorage["user_id"] = data.id;
                                    window.localStorage["username"] = data.username;
                                    window.localStorage["logged"] = true;
                                    window.location.href = "./home.html";
                                }
                                else {
                                    alert('Invalid Username/Password');
                                    window.location = "login.html";
//                                    window.location.replace='./login.html';
                                }
                            },
                            error: function(error) {
                                //alert(response.success);
                                alert('Could not connect to the database ' + error.status);
                                window.location = "login.html";
                            }
                        });

                    } else {
                        alert('Username or Password not be empty');
                        window.location.replace('login.html');
                    }
                });
                return false;
            });
        </script>
    </body>
</html>